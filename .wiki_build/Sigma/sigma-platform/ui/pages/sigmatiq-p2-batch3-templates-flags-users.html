<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIGMATIQ - P2: Templates, Feature Flags & Users</title>
  <style>
    :root{
      --sigmatiq-dark-teal:#1A2F2F;
      --sigmatiq-bright-teal:#00C4A7;
      --sigmatiq-golden:#FFB800;
      --color-bg:#0A1414;
      --color-surface-1:#0F1A1A;
      --color-surface-2:#111827;
      --color-surface-3:#1A2F2F;
      --color-border:#1A2F2F;
      --color-text-1:#F5F5F7;
      --color-text-2:#8FA5A5;
      --color-text-3:#6A8080;
      --status-success:#00C4A7;
      --status-warning:#FFB800;
      --status-error:#FF5757;
      --status-info:#3B82F6;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Inter,sans-serif;background:var(--color-bg);color:var(--color-text-1);padding:24px}
    .section{margin-bottom:48px;max-width:1400px;margin-left:auto;margin-right:auto}
    .section-title{color:var(--sigmatiq-bright-teal);font-size:24px;margin-bottom:24px;padding-bottom:12px;border-bottom:1px solid var(--color-border)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-1);font-weight:600;cursor:pointer;transition:.2s;font-size:14px}
    .btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.2)}
    .btn-primary{background:var(--sigmatiq-bright-teal);border-color:var(--sigmatiq-bright-teal);color:var(--color-bg)}
    .btn-warning{background:var(--status-warning);border-color:var(--status-warning);color:var(--color-bg)}
    .btn-danger{background:var(--status-error);border-color:var(--status-error);color:#fff}
    .btn-small{padding:6px 12px;font-size:12px}
    .btn-group{display:flex;gap:8px}

    /* =============== COMMON CONTROL STRIP =============== */
    .control-strip{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .search-wrap{flex:1;min-width:220px;position:relative}
    .search-wrap input{width:100%;padding:8px 12px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-1);font-size:13px;outline:none}
    .search-wrap input:focus{border-color:var(--sigmatiq-bright-teal);box-shadow:0 0 0 2px rgba(0,196,167,.12)}
    .ctrl-select{padding:8px 12px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-1);font-size:13px;cursor:pointer}
    .view-toggle{display:flex;gap:2px;padding:3px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px}
    .view-option{padding:5px 8px;background:transparent;border:none;color:var(--color-text-2);cursor:pointer;border-radius:5px;font-size:12px}
    .view-option.active{background:var(--sigmatiq-bright-teal);color:var(--color-bg)}
    .pagination-bar{display:flex;justify-content:space-between;align-items:center;padding:12px 0 0}
    .page-btn{padding:6px 10px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:6px;color:var(--color-text-1);font-size:12px;cursor:pointer;min-width:32px}
    .page-btn[disabled]{opacity:.5;cursor:not-allowed}
    .page-btn.active{background:var(--sigmatiq-bright-teal);border-color:var(--sigmatiq-bright-teal);color:var(--color-bg)}

    /* =============== TEMPLATES MANAGER =============== */
    .templates-manager-container{background:var(--color-surface-1);border:1px solid var(--color-border);border-radius:12px;padding:24px}
    .templates-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .templates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px;align-items:stretch}
    .templates-grid.row-view{display:block}
    .template-card{background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:10px;overflow:hidden;transition:.2s}
    .template-card:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.2);border-color:var(--sigmatiq-bright-teal)}
    .template-card .t-head{display:flex;align-items:center;gap:10px;background:var(--color-surface-3);padding:12px;border-bottom:1px solid var(--color-border)}
    .t-name{font-size:13px;font-weight:700;color:var(--color-text-1);font-family:Monaco,Menlo,Consolas,monospace;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer}
    .t-pack{font-size:11px;color:var(--color-text-3)}
    .t-badge{margin-left:auto;padding:2px 6px;border-radius:10px;font-size:9px;font-weight:700}
    .t-badge.published{background:rgba(0,196,167,.2);color:var(--status-success)}
    .t-badge.draft{background:rgba(255,184,0,.2);color:var(--status-warning)}
    .t-badge.archived{background:rgba(134,142,150,.2);color:var(--color-text-3)}
    .template-card .t-body{padding:12px}
    .t-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:10px}
    .t-item{display:flex;flex-direction:column}
    .t-label{font-size:10px;color:var(--color-text-3);text-transform:uppercase;letter-spacing:.3px;margin-bottom:2px}
    .t-value{font-size:14px;font-weight:600;color:var(--color-text-1)}
    .t-meta{display:flex;justify-content:space-between;padding-top:8px;border-top:1px solid var(--color-border);font-size:10px;color:var(--color-text-3)}
    .t-actions{padding:8px;background:var(--color-surface-3);border-top:1px solid var(--color-border);display:flex;gap:6px}
    .t-actions .card-btn{flex:1;padding:6px 10px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:6px;color:var(--color-text-1);font-size:11px;font-weight:500;cursor:pointer;transition:.2s;text-align:center}
    .t-actions .card-btn:hover{background:var(--sigmatiq-bright-teal);border-color:var(--sigmatiq-bright-teal);color:var(--color-bg)}
    /* Row reflow for templates */
    .templates-grid.row-view .template-card{display:flex;align-items:center;margin-bottom:8px;padding:12px;border-radius:8px}
    .templates-grid.row-view .template-card .t-head{background:transparent;border:0;padding:0;gap:12px;flex:0 0 340px}
    .templates-grid.row-view .t-body{flex:1;padding:0 16px}
    .templates-grid.row-view .t-grid{display:flex;gap:20px;margin:0}
    .templates-grid.row-view .t-item{flex-direction:row;gap:6px;align-items:baseline}
    .templates-grid.row-view .t-actions{padding:0;background:transparent;border:0;flex:0 0 auto}

    /* Template Editor (unchanged) */
    .template-editor{background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;padding:20px;margin-top:20px}
    .editor-tabs{display:flex;gap:8px;margin-bottom:20px;border-bottom:1px solid var(--color-border)}
    .editor-tab{padding:12px 20px;background:none;border:none;color:var(--color-text-2);font-weight:500;cursor:pointer;position:relative}
    .editor-tab.active{color:var(--sigmatiq-bright-teal)}
    .editor-tab.active::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background:var(--sigmatiq-bright-teal)}
    .yaml-editor{background:var(--color-surface-1);border:1px solid var(--color-border);border-radius:6px;padding:16px;font-family:Monaco,Consolas,monospace;font-size:12px;color:var(--color-text-1);min-height:400px;overflow:auto;white-space:pre}
    .template-metadata-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
    .metadata-field{display:flex;flex-direction:column;gap:8px}
    .metadata-label{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--color-text-2)}
    .metadata-input{padding:10px 14px;background:var(--color-surface-1);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-1);outline:none}
    .metadata-input:focus{border-color:var(--sigmatiq-bright-teal);box-shadow:0 0 0 3px rgba(0,196,167,.1)}

    /* =============== FEATURE FLAGS =============== */
    .feature-flags-container{background:var(--color-surface-1);border:1px solid var(--color-border);border-radius:12px;padding:24px}
    .flags-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;align-items:stretch;margin-top:12px}
    .flags-grid.row-view{display:block}
    .flag-card{background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;padding:20px;display:flex;justify-content:space-between;align-items:center}
    .flag-info{flex:1}
    .flag-name{font-size:16px;font-weight:600;margin-bottom:4px;font-family:Monaco,monospace}
    .flag-description{font-size:14px;color:var(--color-text-2);margin-bottom:8px}
    .flag-metadata{display:flex;gap:16px;font-size:11px;color:var(--color-text-3);flex-wrap:wrap}
    .flag-toggle{position:relative;width:60px;height:32px}
    .toggle-switch{position:absolute;opacity:0;width:0;height:0}
    .toggle-label{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--color-surface-3);border-radius:34px;transition:.3s}
    .toggle-label:before{position:absolute;content:"";height:24px;width:24px;left:4px;bottom:4px;background:#fff;border-radius:50%;transition:.3s}
    .toggle-switch:checked + .toggle-label{background:var(--sigmatiq-bright-teal)}
    .toggle-switch:checked + .toggle-label:before{transform:translateX(28px)}
    .flag-warning{display:flex;align-items:center;gap:8px;padding:12px;background:rgba(255,184,0,.1);border:1px solid var(--status-warning);border-radius:6px;margin-top:8px;font-size:12px}
    /* Row reflow for flags */
    .flags-grid.row-view .flag-card{display:flex;align-items:center;gap:16px;margin-bottom:8px}
    .flags-grid.row-view .flag-info{flex:1}

    /* =============== USERS =============== */
    .users-container{background:var(--color-surface-1);border:1px solid var(--color-border);border-radius:12px;padding:24px}
    .users-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-bottom:24px}
    .user-stat-card{background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;padding:16px;text-align:center}
    .user-stat-value{font-size:28px;font-weight:600}
    .user-stat-label{font-size:11px;color:var(--color-text-3);text-transform:uppercase;margin-top:4px}
    .users-table{width:100%;border-collapse:collapse}
    .users-table th{padding:12px;border-bottom:1px solid var(--color-border);color:var(--color-text-2);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;text-align:left}
    .users-table td{padding:12px;border-bottom:1px solid var(--color-border)}
    .users-table tr:hover{background:var(--color-surface-2)}
    .user-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--sigmatiq-bright-teal),var(--sigmatiq-golden));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:14px}
    .user-info{display:flex;align-items:center;gap:12px}
    .user-details{display:flex;flex-direction:column;gap:2px}
    .user-email{font-weight:500}
    .user-id{font-size:11px;color:var(--color-text-3);font-family:Monaco,monospace}
    .role-badge{padding:4px 10px;border-radius:4px;font-size:11px;font-weight:600}
    .role-badge.admin{background:rgba(255,184,0,.2);color:var(--sigmatiq-golden)}
    .role-badge.editor{background:rgba(0,196,167,.2);color:var(--status-success)}
    .role-badge.viewer{background:rgba(134,142,150,.2);color:var(--color-text-2)}
    .user-status{display:flex;align-items:center;gap:6px}
    .status-indicator{width:8px;height:8px;border-radius:50%}
    .status-indicator.active{background:var(--status-success)}
    .status-indicator.inactive{background:var(--color-text-3)}
    .status-indicator.suspended{background:var(--status-error)}
  </style>
</head>
<body>
  <!-- =================== TEMPLATES MANAGER =================== -->
  <section class="section">
    <h2 class="section-title">Admin - Templates Manager (P2)</h2>
    <div class="templates-manager-container">
      <div class="templates-header">
        <h3 style="font-size:18px">Model Templates Registry</h3>
        <button class="btn btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Create Template
        </button>
      </div>

      <!-- Controls -->
      <div class="control-strip" id="tmControls">
        <div class="search-wrap">
          <input id="tmSearch" type="text" placeholder="Search templates…"/>
        </div>
        <select id="tmPack" class="ctrl-select" aria-label="Pack">
          <option value="">All Packs</option>
          <option value="zerosigma">zerosigma</option>
          <option value="swingsigma">swingsigma</option>
          <option value="gammasigma">gammasigma</option>
          <option value="gapsigma">gapsigma</option>
        </select>
        <select id="tmStatus" class="ctrl-select" aria-label="Status">
          <option value="">All Status</option>
          <option value="published">Published</option>
          <option value="draft">Draft</option>
          <option value="archived">Archived</option>
        </select>
        <select id="tmSort" class="ctrl-select" aria-label="Sort">
          <option value="updated_desc">Sort: Updated</option>
          <option value="name_asc">Sort: Name</option>
          <option value="pack_asc">Sort: Pack</option>
          <option value="version_desc">Sort: Version</option>
          <option value="status_desc">Sort: Status</option>
          <option value="usage_desc">Sort: Usage</option>
        </select>
        <select id="tmPageSize" class="ctrl-select" aria-label="Items">
          <option>6</option><option selected>12</option><option>24</option>
        </select>
        <div class="view-toggle" role="tablist" aria-label="View">
          <button id="tmViewCards" class="view-option active" aria-selected="true">Cards</button>
          <button id="tmViewRows" class="view-option" aria-selected="false">Rows</button>
        </div>
      </div>

      <!-- Grid -->
      <div class="templates-grid" id="templatesGrid">
        <!-- Template 1 -->
        <article class="template-card" data-status="published" data-editor="template-1">
          <div class="t-head">
            <div class="t-head-info">
              <div class="t-name" data-open-editor="template-1">ZeroSigma Starter</div>
              <div class="t-pack">zerosigma</div>
            </div>
            <span class="t-badge published">PUBLISHED</span>
          </div>
          <div class="t-body">
            <div class="t-grid">
              <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v2.1.0</span></div>
              <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">142 models</span></div>
              <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">4 months ago</span></div>
              <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">2 days ago</span></div>
            </div>
            <div class="t-meta"><span>ID: tmpl_zero_210</span><span>Risk: Balanced</span></div>
          </div>
          <div class="t-actions">
            <button class="card-btn" data-open-editor="template-1">Edit</button>
            <button class="card-btn">Clone</button>
            <button class="card-btn">Archive</button>
          </div>
        </article>

        <!-- Template 2 -->
        <article class="template-card" data-status="published" data-editor="template-2">
          <div class="t-head">
            <div class="t-head-info">
              <div class="t-name" data-open-editor="template-2">Swing Momentum</div>
              <div class="t-pack">swingsigma</div>
            </div>
            <span class="t-badge published">PUBLISHED</span>
          </div>
          <div class="t-body">
            <div class="t-grid">
              <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v1.8.2</span></div>
              <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">87 models</span></div>
              <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">8 months ago</span></div>
              <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">1 week ago</span></div>
            </div>
            <div class="t-meta"><span>ID: tmpl_swing_182</span><span>Risk: Conservative</span></div>
          </div>
          <div class="t-actions">
            <button class="card-btn" data-open-editor="template-2">Edit</button>
            <button class="card-btn">Clone</button>
            <button class="card-btn">Archive</button>
          </div>
        </article>

        <!-- Template 3 -->
        <article class="template-card" data-status="draft">
          <div class="t-head">
            <div class="t-head-info">
              <div class="t-name">Gamma Unwind (Beta)</div>
              <div class="t-pack">gammasigma</div>
            </div>
            <span class="t-badge draft">DRAFT</span>
          </div>
          <div class="t-body">
            <div class="t-grid">
              <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v0.9.5</span></div>
              <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">0 models</span></div>
              <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">1 week ago</span></div>
              <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">3 hours ago</span></div>
            </div>
            <div class="t-meta"><span>ID: tmpl_gamma_095</span><span>Risk: Aggressive</span></div>
          </div>
          <div class="t-actions">
            <button class="card-btn">Edit</button>
            <button class="card-btn btn-primary">Publish</button>
            <button class="card-btn">Delete</button>
          </div>
        </article>

        <!-- Template 4 -->
        <article class="template-card" data-status="archived">
          <div class="t-head">
            <div class="t-head-info">
              <div class="t-name">Opening Drive (Legacy)</div>
              <div class="t-pack">zerosigma</div>
            </div>
            <span class="t-badge archived">ARCHIVED</span>
          </div>
          <div class="t-body">
            <div class="t-grid">
              <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v1.0.0</span></div>
              <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">23 models</span></div>
              <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">2 years ago</span></div>
              <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">2 months ago</span></div>
            </div>
            <div class="t-meta"><span>ID: tmpl_zero_100</span><span>Risk: —</span></div>
          </div>
          <div class="t-actions">
            <button class="card-btn">View</button>
            <button class="card-btn">Restore</button>
          </div>
        </article>

        <!-- Extra examples to exercise paging/sort -->
        <article class="template-card" data-status="published">
          <div class="t-head"><div class="t-head-info"><div class="t-name">Gap Breakout</div><div class="t-pack">gapsigma</div></div><span class="t-badge published">PUBLISHED</span></div>
          <div class="t-body"><div class="t-grid">
            <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v1.2.0</span></div>
            <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">51 models</span></div>
            <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">6 months ago</span></div>
            <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">4 days ago</span></div>
          </div><div class="t-meta"><span>ID: tmpl_gap_120</span><span>Risk: Balanced</span></div></div>
          <div class="t-actions"><button class="card-btn">Open</button><button class="card-btn">Clone</button><button class="card-btn">Archive</button></div>
        </article>

        <article class="template-card" data-status="published">
          <div class="t-head"><div class="t-head-info"><div class="t-name">Weekly Rotator</div><div class="t-pack">swingsigma</div></div><span class="t-badge published">PUBLISHED</span></div>
          <div class="t-body"><div class="t-grid">
            <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v2.0.1</span></div>
            <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">33 models</span></div>
            <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">3 months ago</span></div>
            <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">5 days ago</span></div>
          </div><div class="t-meta"><span>ID: tmpl_swing_201</span><span>Risk: Conservative</span></div></div>
          <div class="t-actions"><button class="card-btn">Open</button><button class="card-btn">Clone</button><button class="card-btn">Archive</button></div>
        </article>

        <article class="template-card" data-status="draft">
          <div class="t-head"><div class="t-head-info"><div class="t-name">Event Drive Beta</div><div class="t-pack">zerosigma</div></div><span class="t-badge draft">DRAFT</span></div>
          <div class="t-body"><div class="t-grid">
            <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v0.4.0</span></div>
            <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">3 models</span></div>
            <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">2 weeks ago</span></div>
            <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">1 day ago</span></div>
          </div><div class="t-meta"><span>ID: tmpl_zero_040</span><span>Risk: Aggressive</span></div></div>
          <div class="t-actions"><button class="card-btn">Edit</button><button class="card-btn btn-primary">Publish</button><button class="card-btn">Delete</button></div>
        </article>

        <article class="template-card" data-status="published">
          <div class="t-head"><div class="t-head-info"><div class="t-name">ETF Mean Revert</div><div class="t-pack">zerosigma</div></div><span class="t-badge published">PUBLISHED</span></div>
          <div class="t-body"><div class="t-grid">
            <div class="t-item"><span class="t-label">Version</span><span class="t-value t-version">v1.3.7</span></div>
            <div class="t-item"><span class="t-label">Usage</span><span class="t-value t-usage">64 models</span></div>
            <div class="t-item"><span class="t-label">Created</span><span class="t-value t-created">11 months ago</span></div>
            <div class="t-item"><span class="t-label">Updated</span><span class="t-value t-updated">8 hours ago</span></div>
          </div><div class="t-meta"><span>ID: tmpl_zero_137</span><span>Risk: Balanced</span></div></div>
          <div class="t-actions"><button class="card-btn">Open</button><button class="card-btn">Clone</button><button class="card-btn">Archive</button></div>
        </article>
      </div>

      <!-- Pagination -->
      <div class="pagination-bar" id="tmPagination">
        <div id="tmPageInfo" style="font-size:13px;color:var(--color-text-2)">–</div>
        <div style="display:flex;gap:6px;align-items:center">
          <button class="page-btn" id="tmPrev">‹</button>
          <span id="tmNums" style="display:flex;gap:6px"></span>
          <button class="page-btn" id="tmNext">›</button>
        </div>
      </div>

      <!-- Template Editor (collapsible) -->
      <div class="template-editor" id="template-1-editor" style="display:none">
        <h4 style="margin-bottom:16px">Edit Template: ZeroSigma Starter</h4>
        <div class="editor-tabs">
          <button class="editor-tab active">Metadata</button>
          <button class="editor-tab">YAML Config</button>
          <button class="editor-tab">Validation</button>
          <button class="editor-tab">Preview</button>
        </div>
        <div class="template-metadata-grid">
          <div class="metadata-field"><label class="metadata-label">Template Name</label><input type="text" class="metadata-input" value="ZeroSigma Starter"/></div>
          <div class="metadata-field"><label class="metadata-label">Pack</label><select class="metadata-input"><option selected>zerosigma</option><option>swingsigma</option><option>gapsigma</option></select></div>
          <div class="metadata-field"><label class="metadata-label">Horizon</label><input type="text" class="metadata-input" value="0DTE"/></div>
          <div class="metadata-field"><label class="metadata-label">Cadence</label><input type="text" class="metadata-input" value="hourly"/></div>
          <div class="metadata-field"><label class="metadata-label">Default Risk Profile</label><select class="metadata-input"><option>Conservative</option><option selected>Balanced</option><option>Aggressive</option></select></div>
          <div class="metadata-field"><label class="metadata-label">Min Data Days</label><input type="number" class="metadata-input" value="30"/></div>
        </div>
        <div style="margin-top:20px">
          <div class="metadata-label">YAML Configuration</div>
<pre class="yaml-editor">template:
  name: zerosigma_starter
  version: 2.1.0
  pack: zerosigma

indicators:
  - pin_drift_v1
  - headfake_v2
  - momentum_gate

policy:
  execution:
    momentum_gate: false
    wait_for_confirmation: true

  risk:
    max_position_size: 1000
    stop_loss_pct: 2.0

sweeps_defaults:
  thresholds: [0.50, 0.55, 0.60]
  allowed_hours: [[13,14], [13,14,15]]
  top_pct: [0.10, 0.15]</pre>
        </div>
        <div class="btn-group" style="margin-top:20px">
          <button class="btn">Save Draft</button>
          <button class="btn">Validate</button>
          <button class="btn btn-primary">Publish v2.2.0</button>
        </div>
      </div>
    </div>
  </section>

  <!-- =================== FEATURE FLAGS =================== -->
  <section class="section">
    <h2 class="section-title">Admin - Feature Flags (P2)</h2>
    <div class="feature-flags-container">
      <div class="templates-header">
        <h3 style="font-size:18px">Feature Toggles</h3>
        <div style="font-size:12px;color:var(--color-text-2)">Changes take effect immediately • All changes are logged</div>
      </div>

      <!-- Controls -->
      <div class="control-strip" id="flagsControls">
        <div class="search-wrap"><input id="flagSearch" type="text" placeholder="Search flags…"/></div>
        <select id="flagSort" class="ctrl-select" aria-label="Sort">
          <option value="modified_desc">Sort: Modified</option>
          <option value="created_desc">Sort: Created</option>
          <option value="name_asc">Sort: Name</option>
          <option value="status_desc">Sort: Status (enabled first)</option>
        </select>
        <select id="flagPageSize" class="ctrl-select" aria-label="Items">
          <option>6</option><option selected>12</option><option>24</option>
        </select>
        <div class="view-toggle" role="tablist" aria-label="View">
          <button id="viewCards" class="view-option active" aria-selected="true">Cards</button>
          <button id="viewRows" class="view-option" aria-selected="false">Rows</button>
        </div>
      </div>

      <div class="flags-grid" id="flagsGrid">
        <!-- AI Assistant Execute -->
        <div class="flag-card">
          <div class="flag-info">
            <div class="flag-name">assistant_execute_enabled</div>
            <div class="flag-description">Allow AI Assistant to execute compute operations with user confirmation</div>
            <div class="flag-metadata"><span>Created: 3 months ago</span><span>Last modified: 2 days ago</span><span>Modified by: admin@example.com</span></div>
          </div>
          <div class="flag-toggle"><input type="checkbox" id="flag1" class="toggle-switch" checked/><label for="flag1" class="toggle-label"></label></div>
        </div>

        <!-- Ad-hoc Backtest -->
        <div class="flag-card">
          <div class="flag-info">
            <div class="flag-name">adhoc_backtest_enabled</div>
            <div class="flag-description">Show ad-hoc Backtest tab in Build/Train/Backtest section</div>
            <div class="flag-metadata"><span>Created: 1 month ago</span><span>Last modified: 1 week ago</span><span>Modified by: admin@example.com</span></div>
          </div>
          <div class="flag-toggle"><input type="checkbox" id="flag2" class="toggle-switch" checked/><label for="flag2" class="toggle-label"></label></div>
        </div>

        <!-- Signals Leaderboard -->
        <div class="flag-card">
          <div class="flag-info">
            <div class="flag-name">signals_leaderboard_visible</div>
            <div class="flag-description">Show Signals Leaderboard to all users (not just admins)</div>
            <div class="flag-metadata"><span>Created: 2 weeks ago</span><span>Last modified: 3 days ago</span><span>Modified by: developer@example.com</span></div>
          </div>
          <div class="flag-toggle"><input type="checkbox" id="flag3" class="toggle-switch"/><label for="flag3" class="toggle-label"></label></div>
        </div>

        <!-- Advanced Research -->
        <div class="flag-card">
          <div class="flag-info">
            <div class="flag-name">advanced_research_beta</div>
            <div class="flag-description">Enable Advanced Research button for deep analysis (10+ min searches)</div>
            <div class="flag-metadata"><span>Created: 1 week ago</span><span>Last modified: Never</span><span>Modified by: —</span></div>
            <div class="flag-warning">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--status-warning)" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/>
              </svg>
              <span>Beta feature - may impact system performance</span>
            </div>
          </div>
          <div class="flag-toggle"><input type="checkbox" id="flag4" class="toggle-switch"/><label for="flag4" class="toggle-label"></label></div>
        </div>

        <!-- Mobile Trading -->
        <div class="flag-card">
          <div class="flag-info">
            <div class="flag-name">mobile_trading_enabled</div>
            <div class="flag-description">Enable trading actions from mobile devices</div>
            <div class="flag-metadata"><span>Created: 2 months ago</span><span>Last modified: 1 month ago</span><span>Modified by: security@example.com</span></div>
          </div>
          <div class="flag-toggle"><input type="checkbox" id="flag5" class="toggle-switch" checked/><label for="flag5" class="toggle-label"></label></div>
        </div>
      </div>

      <!-- Flags pagination -->
      <div class="pagination-bar" id="flagsPagination">
        <div id="pageInfo" style="font-size:13px;color:var(--color-text-2)">–</div>
        <div style="display:flex;gap:6px">
          <button class="page-btn" id="prevPage">‹</button>
          <span id="pageNumbers" style="display:flex;gap:6px"></span>
          <button class="page-btn" id="nextPage">›</button>
        </div>
      </div>
    </div>
  </section>

  <!-- =================== USERS & ROLES =================== -->
  <section class="section">
    <h2 class="section-title">Admin - Users & Roles (P2)</h2>
    <div class="users-container">
      <div class="templates-header">
        <h3 style="font-size:18px">User Management</h3>
        <button class="btn btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
          Add User
        </button>
      </div>

      <div class="users-stats">
        <div class="user-stat-card"><div class="user-stat-value">247</div><div class="user-stat-label">Total Users</div></div>
        <div class="user-stat-card"><div class="user-stat-value">18</div><div class="user-stat-label">Active Now</div></div>
        <div class="user-stat-card"><div class="user-stat-value">3</div><div class="user-stat-label">Admins</div></div>
        <div class="user-stat-card"><div class="user-stat-value">42</div><div class="user-stat-label">Editors</div></div>
        <div class="user-stat-card"><div class="user-stat-value">202</div><div class="user-stat-label">Viewers</div></div>
        <div class="user-stat-card"><div class="user-stat-value">2</div><div class="user-stat-label">Suspended</div></div>
      </div>

      <table class="users-table">
        <thead><tr><th>User</th><th>Role</th><th>Status</th><th>Last Active</th><th>API Token</th><th>Actions</th></tr></thead>
        <tbody>
          <tr>
            <td><div class="user-info"><div class="user-avatar">JD</div><div class="user-details"><span class="user-email">john.doe@example.com</span><span class="user-id">usr_abc123def456</span></div></div></td>
            <td><select class="ctrl-select" style="padding:6px 10px"><option>Viewer</option><option selected>Editor</option><option>Admin</option></select></td>
            <td><div class="user-status"><span class="status-indicator active"></span><span style="font-size:12px">Active</span></div></td>
            <td style="font-size:12px;color:var(--color-text-2)">2 min ago</td>
            <td><span style="font-family:Monaco,monospace;font-size:11px">sk_live_***def</span></td>
            <td><div class="btn-group"><button class="btn btn-small">Edit</button><button class="btn btn-small btn-warning">Rotate Token</button><button class="btn btn-small">Suspend</button></div></td>
          </tr>
          <tr>
            <td><div class="user-info"><div class="user-avatar" style="background:linear-gradient(135deg,var(--sigmatiq-golden),var(--status-warning))">AS</div><div class="user-details"><span class="user-email">admin@sigmatiq.com</span><span class="user-id">usr_admin001</span></div></div></td>
            <td><span class="role-badge admin">ADMIN</span></td>
            <td><div class="user-status"><span class="status-indicator active"></span><span style="font-size:12px">Active</span></div></td>
            <td style="font-size:12px;color:var(--color-text-2)">Now</td>
            <td><span style="font-family:Monaco,monospace;font-size:11px">sk_live_***xyz</span></td>
            <td><div class="btn-group"><button class="btn btn-small">Edit</button><button class="btn btn-small btn-warning">Rotate Token</button></div></td>
          </tr>
          <tr>
            <td><div class="user-info"><div class="user-avatar" style="background:var(--color-text-3)">TU</div><div class="user-details"><span class="user-email">test.user@example.com</span><span class="user-id">usr_test789ghi</span></div></div></td>
            <td><span class="role-badge viewer">VIEWER</span></td>
            <td><div class="user-status"><span class="status-indicator inactive"></span><span style="font-size:12px">Inactive</span></div></td>
            <td style="font-size:12px;color:var(--color-text-2)">3 days ago</td>
            <td><span style="font-family:Monaco,monospace;font-size:11px">sk_test_***abc</span></td>
            <td><div class="btn-group"><button class="btn btn-small">Edit</button><button class="btn btn-small btn-warning">Rotate Token</button><button class="btn btn-small">Suspend</button></div></td>
          </tr>
          <tr>
            <td><div class="user-info"><div class="user-avatar" style="background:var(--status-error)">SU</div><div class="user-details"><span class="user-email">suspended@example.com</span><span class="user-id">usr_sus456jkl</span></div></div></td>
            <td><span class="role-badge viewer">VIEWER</span></td>
            <td><div class="user-status"><span class="status-indicator suspended"></span><span style="font-size:12px;color:var(--status-error)">Suspended</span></div></td>
            <td style="font-size:12px;color:var(--color-text-2)">2 weeks ago</td>
            <td><span style="font-family:Monaco,monospace;font-size:11px;color:var(--color-text-3)">Revoked</span></td>
            <td><div class="btn-group"><button class="btn btn-small btn-primary">Restore</button><button class="btn btn-small btn-danger">Delete</button></div></td>
          </tr>
        </tbody>
      </table>

      <h4 style="margin-top:32px;margin-bottom:16px">Recent Admin Actions</h4>
      <div class="audit-log" style="background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;padding:16px;max-height:300px;overflow-y:auto">
        <div class="audit-entry" style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--color-border);font-size:12px">
          <span class="audit-timestamp" style="color:var(--color-text-3);min-width:120px">2025-08-19 14:45:23</span>
          <span class="audit-action" style="color:var(--sigmatiq-bright-teal);font-weight:500">ROLE_CHANGED</span>
          <span class="audit-details" style="color:var(--color-text-2)">admin@sigmatiq.com changed john.doe@example.com from Viewer to Editor</span>
        </div>
        <div class="audit-entry" style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--color-border);font-size:12px">
          <span class="audit-timestamp" style="color:var(--color-text-3);min-width:120px">2025-08-19 14:32:15</span>
          <span class="audit-action" style="color:var(--sigmatiq-bright-teal);font-weight:500">TOKEN_ROTATED</span>
          <span class="audit-details" style="color:var(--color-text-2)">admin@sigmatiq.com rotated API token for test.user@example.com</span>
        </div>
        <div class="audit-entry" style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--color-border);font-size:12px">
          <span class="audit-timestamp" style="color:var(--color-text-3);min-width:120px">2025-08-19 13:28:41</span>
          <span class="audit-action" style="color:var(--sigmatiq-bright-teal);font-weight:500">USER_SUSPENDED</span>
          <span class="audit-details" style="color:var(--color-text-2)">security@sigmatiq.com suspended suspended@example.com - Reason: Quota violations</span>
        </div>
        <div class="audit-entry" style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--color-border);font-size:12px">
          <span class="audit-timestamp" style="color:var(--color-text-3);min-width:120px">2025-08-19 11:15:02</span>
          <span class="audit-action" style="color:var(--sigmatiq-bright-teal);font-weight:500">USER_CREATED</span>
          <span class="audit-details" style="color:var(--color-text-2)">admin@sigmatiq.com created new user newuser@example.com with Editor role</span>
        </div>
        <div class="audit-entry" style="display:flex;align-items:center;gap:12px;padding:8px 0;font-size:12px">
          <span class="audit-timestamp" style="color:var(--color-text-3);min-width:120px">2025-08-19 09:45:18</span>
          <span class="audit-action" style="color:var(--sigmatiq-bright-teal);font-weight:500">QUOTA_MODIFIED</span>
          <span class="audit-details" style="color:var(--color-text-2)">admin@sigmatiq.com increased sweep quota for john.doe@example.com from 5 to 10</span>
        </div>
      </div>
    </div>
  </section>

  <script>
    /* ===== Template Editor toggle (kept) ===== */
    function toggleEditor(templateId){
      const editor=document.getElementById(templateId+'-editor');
      if(editor){editor.style.display=editor.style.display==='none'?'block':'none';}
    }

    /* ===== Model Templates: search • filters • sort • paging • view toggle ===== */
    (function(){
      const grid=document.getElementById('templatesGrid');
      if(!grid) return;
      const cards=[...grid.querySelectorAll('.template-card')];

      const q=document.getElementById('tmSearch');
      const packSel=document.getElementById('tmPack');
      const statusSel=document.getElementById('tmStatus');
      const sortSel=document.getElementById('tmSort');
      const sizeSel=document.getElementById('tmPageSize');

      const prev=document.getElementById('tmPrev');
      const next=document.getElementById('tmNext');
      const nums=document.getElementById('tmNums');
      const info=document.getElementById('tmPageInfo');

      const viewCards=document.getElementById('tmViewCards');
      const viewRows=document.getElementById('tmViewRows');

      /* wire editor open on name/buttons */
      document.querySelectorAll('[data-open-editor]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleEditor(btn.getAttribute('data-open-editor')); });
      });

      function parseRelative(s){
        if(!s) return Infinity;
        s=s.toLowerCase();
        if(s.includes('never')) return Infinity;
        if(s.includes('now')) return 0;
        const m=s.match(/(\d+)\s*(min|hour|day|week|month|year)s?\s*ago/);
        if(!m) return Infinity;
        const n=parseInt(m[1],10);
        const unit=m[2];
        const minutes={min:1,hour:60,day:1440,week:10080,month:43200,year:525600}[unit]||1;
        return n*minutes;
      }
      function parseSemver(v){
        const m=(v||'').trim().replace(/^v/i,'').split('.');
        return [parseInt(m[0]||0,10),parseInt(m[1]||0,10),parseInt(m[2]||0,10)];
      }
      function usageNum(s){
        const m=(s||'').match(/(\d+)/); return m?parseInt(m[1],10):0;
      }
      function cardData(el){
        return {
          el,
          name: el.querySelector('.t-name')?.textContent.trim()||'',
          pack: el.querySelector('.t-pack')?.textContent.trim()||'',
          status: el.getAttribute('data-status')||'',
          version: el.querySelector('.t-version')?.textContent.trim()||'',
          versionArr: parseSemver(el.querySelector('.t-version')?.textContent||''),
          usage: usageNum(el.querySelector('.t-usage')?.textContent||''),
          createdMin: parseRelative(el.querySelector('.t-created')?.textContent||''),
          updatedMin: parseRelative(el.querySelector('.t-updated')?.textContent||'')
        };
      }
      const rows=cards.map(cardData);

      let state={term:'', pack:'', status:'', sort:'updated_desc', page:1, size:parseInt(sizeSel.value,10)};

      function apply(){
        // refresh live values if needed
        rows.forEach(r=>{
          r.usage=usageNum(r.el.querySelector('.t-usage')?.textContent||r.usage);
          r.updatedMin=parseRelative(r.el.querySelector('.t-updated')?.textContent||'');
        });

        // filter
        const t=state.term.toLowerCase();
        let filtered=rows.filter(r=>
          (!t || r.name.toLowerCase().includes(t) || r.pack.toLowerCase().includes(t)) &&
          (!state.pack || r.pack===state.pack) &&
          (!state.status || r.status===state.status)
        );

        // sort
        const sorters={
          updated_desc:(a,b)=>a.updatedMin-b.updatedMin,
          name_asc:(a,b)=>a.name.localeCompare(b.name),
          pack_asc:(a,b)=>a.pack.localeCompare(b.pack)||a.name.localeCompare(b.name),
          version_desc:(a,b)=>(
            b.versionArr[0]-a.versionArr[0]||
            b.versionArr[1]-a.versionArr[1]||
            b.versionArr[2]-a.versionArr[2]
          ),
          status_desc:(a,b)=>a.status.localeCompare(b.status),
          usage_desc:(a,b)=>b.usage-a.usage
        };
        filtered.sort(sorters[state.sort]||sorters.updated_desc);

        // pagination
        const total=filtered.length;
        const pages=Math.max(1,Math.ceil(total/state.size));
        state.page=Math.min(state.page,pages);
        const start=(state.page-1)*state.size;
        const pageSlice=filtered.slice(start,start+state.size);

        // reorder DOM
        const frag=document.createDocumentFragment();
        pageSlice.forEach(r=>frag.appendChild(r.el));
        grid.innerHTML='';
        grid.appendChild(frag);

        // page UI
        info.textContent= total ? `Showing ${start+1}–${Math.min(start+state.size,total)} of ${total} templates` : 'No results';
        nums.innerHTML='';
        for(let i=1;i<=pages;i++){
          const b=document.createElement('button');
          b.className='page-btn'+(i===state.page?' active':'');
          b.textContent=i;
          b.addEventListener('click',()=>{state.page=i;apply();});
          nums.appendChild(b);
        }
        prev.disabled=state.page===1;
        next.disabled=state.page===pages;
      }

      // events
      q.addEventListener('input',e=>{state.term=e.target.value;state.page=1;apply();});
      packSel.addEventListener('change',e=>{state.pack=e.target.value;state.page=1;apply();});
      statusSel.addEventListener('change',e=>{state.status=e.target.value;state.page=1;apply();});
      sortSel.addEventListener('change',e=>{state.sort=e.target.value;state.page=1;apply();});
      sizeSel.addEventListener('change',e=>{state.size=parseInt(e.target.value,10);state.page=1;apply();});
      prev.addEventListener('click',()=>{if(state.page>1){state.page--;apply();}});
      next.addEventListener('click',()=>{state.page++;apply();});

      viewCards.addEventListener('click',()=>{viewCards.classList.add('active');viewRows.classList.remove('active');grid.classList.remove('row-view');});
      viewRows.addEventListener('click',()=>{viewRows.classList.add('active');viewCards.classList.remove('active');grid.classList.add('row-view');});

      // init
      apply();
    })();

    /* ===== Feature Flags: search • sort • paging • view toggle ===== */
    (function(){
      const grid=document.getElementById('flagsGrid'); if(!grid) return;
      const cards=[...grid.querySelectorAll('.flag-card')];

      const q=document.getElementById('flagSearch');
      const sortSel=document.getElementById('flagSort');
      const sizeSel=document.getElementById('flagPageSize');
      const prev=document.getElementById('prevPage');
      const next=document.getElementById('nextPage');
      const nums=document.getElementById('pageNumbers');
      const info=document.getElementById('pageInfo');
      const viewCards=document.getElementById('viewCards');
      const viewRows=document.getElementById('viewRows');

      function parseRelative(s){
        if(!s) return Infinity;
        s=s.toLowerCase();
        if(s.includes('never')) return Infinity;
        if(s.includes('now')) return 0;
        const m=s.match(/(\d+)\s*(min|hour|day|week|month|year)s?\s*ago/);
        if(!m) return Infinity;
        const n=parseInt(m[1],10);
        const unit=m[2];
        const minutes={min:1,hour:60,day:1440,week:10080,month:43200,year:525600}[unit]||1;
        return n*minutes;
      }
      function cardData(el){
        const name=el.querySelector('.flag-name')?.textContent.trim()||'';
        const desc=el.querySelector('.flag-description')?.textContent.trim()||'';
        const meta=el.querySelectorAll('.flag-metadata span');
        const created=meta[0]?.textContent.replace('Created:','').trim()||'';
        const modified=meta[1]?.textContent.replace('Last modified:','').trim()||'';
        const enabled=el.querySelector('.toggle-switch')?.checked?1:0;
        return {el,name,desc,createdMin:parseRelative(created),modifiedMin:parseRelative(modified),enabled};
      }
      const rows=cards.map(cardData);
      let state={term:'',sort:'modified_desc',page:1,size:parseInt(sizeSel.value,10)};

      function apply(){
        rows.forEach(r=>{r.enabled=r.el.querySelector('.toggle-switch')?.checked?1:0;});
        const t=state.term.toLowerCase();
        const filtered=rows.filter(r=>!t||r.name.toLowerCase().includes(t)||r.desc.toLowerCase().includes(t));
        const sorters={
          modified_desc:(a,b)=>a.modifiedMin-b.modifiedMin,
          created_desc:(a,b)=>a.createdMin-b.createdMin,
          name_asc:(a,b)=>a.name.localeCompare(b.name),
          status_desc:(a,b)=>b.enabled-a.enabled||a.name.localeCompare(b.name),
        };
        filtered.sort(sorters[state.sort]||sorters.modified_desc);
        const total=filtered.length;
        const pages=Math.max(1,Math.ceil(total/state.size));
        state.page=Math.min(state.page,pages);
        const start=(state.page-1)*state.size;
        const slice=filtered.slice(start,start+state.size);
        const frag=document.createDocumentFragment(); slice.forEach(r=>frag.appendChild(r.el));
        grid.innerHTML=''; grid.appendChild(frag);
        info.textContent= total ? `Showing ${start+1}–${Math.min(start+state.size,total)} of ${total} flags` : 'No results';
        nums.innerHTML=''; for(let i=1;i<=pages;i++){const b=document.createElement('button'); b.className='page-btn'+(i===state.page?' active':''); b.textContent=i; b.addEventListener('click',()=>{state.page=i;apply();}); nums.appendChild(b);}
        prev.disabled=state.page===1; next.disabled=state.page===pages;
      }

      q.addEventListener('input',e=>{state.term=e.target.value;state.page=1;apply();});
      sortSel.addEventListener('change',e=>{state.sort=e.target.value;state.page=1;apply();});
      sizeSel.addEventListener('change',e=>{state.size=parseInt(e.target.value,10);state.page=1;apply();});
      prev.addEventListener('click',()=>{if(state.page>1){state.page--;apply();}});
      next.addEventListener('click',()=>{state.page++;apply();});
      viewCards.addEventListener('click',()=>{viewCards.classList.add('active');viewRows.classList.remove('active');grid.classList.remove('row-view');});
      viewRows.addEventListener('click',()=>{viewRows.classList.add('active');viewCards.classList.remove('active');grid.classList.add('row-view');});
      apply();
    })();

    /* ===== Feature flag change handler (kept) ===== */
    document.querySelectorAll('.toggle-switch').forEach(t=>{
      t.addEventListener('change',function(){
        const flagName=this.closest('.flag-card').querySelector('.flag-name').textContent;
        const enabled=this.checked;
        console.log(`Feature flag changed: ${flagName} = ${enabled}`);
      });
    });
  </script>
</body>
</html>
