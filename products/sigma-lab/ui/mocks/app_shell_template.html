<!doctype html>
<html lang="en" data-theme="light" data-density="cozy" data-edge="zerosigma">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sigma Lab — AppShell Template</title>
    <link rel="stylesheet" href="assets/style.css" />
    <style>
      .app-content { padding: 20px; }
      .topbar-right { display: flex; gap: 10px; align-items: center; }
      .select { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 6px; padding: 6px 8px; }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

      /* Command Palette (accessible dialog) */
      .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; }
      .overlay[aria-hidden="false"] { display: block; }
      .cmdk { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: min(720px, 92vw); background: var(--surface-1); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 10px; box-shadow: var(--shadow-md); display: none; }
      .cmdk[aria-hidden="false"] { display: block; }
      .cmdk-header { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid var(--border-color); }
      .cmdk-input { flex: 1; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 6px; padding: 8px 10px; }
      .cmdk-input:focus-visible { outline: none; box-shadow: var(--ring); }
      .cmdk-list { max-height: 320px; overflow: auto; padding: 6px; }
      .cmdk-item { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 10px; border-radius: 6px; cursor: pointer; }
      .cmdk-item:hover, .cmdk-item[aria-selected="true"] { background: var(--bg-hover); }
      .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--bg-tertiary); border: 1px solid var(--border-color); padding: 1px 6px; border-radius: 4px; font-size: 12px; color: var(--text-secondary); }

      /* Trust HUD & Lineage (demo styles) */
      .trust-hud { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
      .trust-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; }
      .trust-badge.integrity { background: rgba(16,185,129,0.12); color: var(--status-success); }
      .trust-badge.parity { background: rgba(245,158,11,0.12); color: var(--status-warning); }
      .trust-badge.capacity { background: rgba(148,163,184,0.12); color: var(--text-secondary); }
      .lineage-chips { display: flex; gap: 6px; }
      .lineage-chip { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border-color); padding: 3px 6px; border-radius: 4px; cursor: pointer; }
      .lineage-chip:focus-visible { outline: none; box-shadow: var(--ring); }
    </style>
  </head>
  <body>
    <div class="app-container">
      <div class="top-bar">
        <div class="logo-section">
          <button class="menu-toggle" aria-label="Toggle menu">☰</button>
          <a href="#" class="logo-container" aria-label="Sigmatiq home">
            <img src="assets/logo.svg" class="logo-mark" alt="Sigmatiq logo" />
            <div class="text-content">
              <div class="sigma-lab">EDGE LAB</div>
              <div class="sigmatiq">SIGMATIQ</div>
              <div class="tagline">EVIDENCE TO GOVERNED ACTION</div>
            </div>
          </a>
        </div>
        <div class="topbar-right">
          <button id="cmdk" class="theme-toggle" aria-label="Open command palette" title="Command Palette (Ctrl/⌘+K)">⌘K</button>
          <button id="themeBtn" class="theme-toggle" aria-label="Toggle theme" title="Theme">◑</button>
          <label>
            <span class="sr-only">Density</span>
            <select id="densitySel" class="select" aria-label="Density">
              <option value="compact">Compact</option>
              <option value="cozy" selected>Cozy</option>
              <option value="comfortable">Comfortable</option>
            </select>
          </label>
          <a class="top-bar-link" href="../docs/ui/README.md" target="_blank" rel="noreferrer">Docs</a>
        </div>
      </div>
      <div class="main-layout">
        <aside class="sidebar">
          <a class="nav-item active" href="#"><span class="nav-icon icon-dashboard"><span></span></span>Dashboard</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-models"><span></span></span>Models</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-build"><span></span></span>Build/Train/Backtest</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-sweeps"><span></span></span>Sweeps</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-leaderboard"><span></span></span>Leaderboard</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-signals"><span></span></span>Signals</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-overlay"><span></span></span>Overlay</a>
          <a class="nav-item" href="#"><span class="nav-icon icon-docs"><span></span></span>Docs</a>
        </aside>
        <main class="content-area">
          <div class="page-container app-content">
            <h1 class="page-title">AppShell Template</h1>
            <p>Use the theme and density controls in the top bar. Tokens from <code>assets/style.css</code> drive surfaces, text, borders, and status colors.</p>

            <h2 class="page-title" style="font-size:20px; margin-top:20px;">Trust & Lineage (Demo)</h2>
            <div class="trust-hud" aria-label="Trust status">
              <div class="trust-badge integrity" role="status" aria-label="Integrity OK">Integrity OK</div>
              <div class="trust-badge parity" role="status" aria-label="Parity drift -2.1%">Parity −2.1%</div>
              <div class="trust-badge capacity" role="status" aria-label="Capacity medium">Capacity: Medium</div>
            </div>
            <div class="lineage-chips" aria-label="Lineage">
              <button class="lineage-chip" type="button" title="Pack revision">pack@a1b2c3d4</button>
              <button class="lineage-chip" type="button" title="Policy revision">policy@e5f6g7h8</button>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- Command Palette scaffold -->
    <div id="overlay" class="overlay" aria-hidden="true"></div>
    <div id="cmdkDialog" class="cmdk" role="dialog" aria-modal="true" aria-labelledby="cmdkTitle" aria-hidden="true">
      <div class="cmdk-header">
        <strong id="cmdkTitle" style="color:var(--text-secondary);">Command Palette</strong>
        <input id="cmdkInput" class="cmdk-input" placeholder="Type a command…" aria-label="Command input" />
        <span class="kbd" aria-hidden="true">Esc</span>
      </div>
      <div class="cmdk-list" role="listbox" aria-label="Commands">
        <div class="cmdk-item" role="option" data-action="build">Build Model… <span class="kbd">B</span></div>
        <div class="cmdk-item" role="option" data-action="train">Train Model… <span class="kbd">T</span></div>
        <div class="cmdk-item" role="option" data-action="backtest">Backtest Model… <span class="kbd">K</span></div>
        <div class="cmdk-item" role="option" data-action="docs">Open Docs <span class="kbd">D</span></div>
        <div class="cmdk-item" role="option" data-action="theme">Toggle Theme <span class="kbd">◑</span></div>
      </div>
    </div>
    <script>
      (function () {
        const root = document.documentElement;
        const ls = window.localStorage;
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
        const userTheme = ls.getItem('ui.theme');
        const userDensity = ls.getItem('ui.density');
        root.dataset.theme = userTheme || (prefersDark.matches ? 'dark' : 'light');
        root.dataset.density = userDensity || 'cozy';

        document.getElementById('themeBtn').addEventListener('click', () => {
          const order = ['light', 'dark', 'slate', 'paper'];
          const next = order[(order.indexOf(root.dataset.theme) + 1) % order.length];
          root.dataset.theme = next; ls.setItem('ui.theme', next);
        });
        document.getElementById('densitySel').addEventListener('change', (e) => {
          const val = e.target.value; root.dataset.density = val; ls.setItem('ui.density', val);
        });
        // Command Palette (accessible)
        const overlay = document.getElementById('overlay');
        const cmdk = document.getElementById('cmdkDialog');
        const cmdkInput = document.getElementById('cmdkInput');
        const cmdBtn = document.getElementById('cmdk');
        const items = () => Array.from(cmdk.querySelectorAll('.cmdk-item'));

        function openCmdk() {
          overlay.setAttribute('aria-hidden', 'false');
          cmdk.setAttribute('aria-hidden', 'false');
          const prev = document.activeElement;
          cmdk.dataset.returnFocus = prev && prev.id ? `#${prev.id}` : '';
          setTimeout(() => cmdkInput.focus(), 0);
        }
        function closeCmdk() {
          overlay.setAttribute('aria-hidden', 'true');
          cmdk.setAttribute('aria-hidden', 'true');
          const sel = cmdk.dataset.returnFocus;
          if (sel) {
            try { document.querySelector(sel)?.focus(); } catch {}
          }
        }
        function handleAction(action) {
          switch (action) {
            case 'docs': window.open('../docs/ui/README.md', '_blank'); break;
            case 'theme': document.getElementById('themeBtn').click(); break;
            case 'build': alert('Build (stub)'); break;
            case 'train': alert('Train (stub)'); break;
            case 'backtest': alert('Backtest (stub)'); break;
          }
          closeCmdk();
        }
        cmdBtn.addEventListener('click', (e) => { e.preventDefault(); openCmdk(); });
        overlay.addEventListener('click', closeCmdk);
        window.addEventListener('keydown', (e) => {
          const isCmdK = (e.ctrlKey || e.metaKey) && (e.key === 'k' || e.key === 'K');
          if (isCmdK) { e.preventDefault(); openCmdk(); }
          if (e.key === 'Escape' && cmdk.getAttribute('aria-hidden') === 'false') { e.preventDefault(); closeCmdk(); }
        });
        cmdk.addEventListener('keydown', (e) => {
          const focusables = [cmdkInput, ...items()];
          const idx = focusables.indexOf(document.activeElement);
          if (e.key === 'Tab') {
            e.preventDefault();
            const next = (idx + (e.shiftKey ? -1 : 1) + focusables.length) % focusables.length;
            focusables[next].focus();
          }
          if (e.key === 'Enter') {
            const el = document.activeElement.closest('.cmdk-item');
            if (el) handleAction(el.dataset.action);
          }
        });
        items().forEach(el => {
          el.tabIndex = 0;
          el.addEventListener('click', () => handleAction(el.dataset.action));
          el.addEventListener('mouseenter', () => items().forEach(i => i.removeAttribute('aria-selected')));
          el.addEventListener('mouseenter', () => el.setAttribute('aria-selected', 'true'));
        });
      })();
    </script>
  </body>
  
</html>
