<!doctype html>
<html lang="en" data-theme="light" data-density="cozy" data-edge="zeroedge">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sigma Lab — UI</title>
    <link rel="stylesheet" href="assets/style.css" />
    <link rel="stylesheet" href="assets/mock_fidelity.css" />
  </head>
  <body>
    <div class="app-container">
      <header class="top-bar">
        <div class="top-bar-inner">
        <div class="logo-section">
          <button class="menu-toggle" id="menu-toggle-btn" aria-label="Toggle menu">☰</button>
          <a href="#/dashboard" class="logo-container" aria-label="Sigmatiq home">
            <!-- Inline SVG logo for crisp rendering across themes -->
            <svg class="logo-mark" viewBox="0 0 45 45" role="img" aria-labelledby="logoTitle logoDesc" xmlns="http://www.w3.org/2000/svg">
              <title id="logoTitle">Sigmatiq Network Mark</title>
              <desc id="logoDesc">Teal circle with four connected nodes forming a cross pattern</desc>
              <circle cx="22.5" cy="22.5" r="22.5" fill="var(--primary-color)"/>
              <!-- Connecting lines forming the cross (drawn first so they appear behind circles) -->
              <rect x="21" y="13" width="3" height="19" fill="var(--ivory)" opacity="0.7"/>
              <rect x="13" y="21" width="19" height="3" fill="var(--ivory)" opacity="0.7"/>
              <!-- Top circle -->
              <g transform="translate(22.5,10)">
                <circle r="5.5" fill="var(--ivory)" stroke="var(--ivory)" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
                <circle r="3" fill="var(--slate)"/>
              </g>
              <!-- Right circle -->
              <g transform="translate(35,22.5)">
                <circle r="5.5" fill="var(--ivory)" stroke="var(--ivory)" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
                <circle r="3" fill="var(--slate)"/>
              </g>
              <!-- Bottom circle -->
              <g transform="translate(22.5,35)">
                <circle r="5.5" fill="var(--ivory)" stroke="var(--ivory)" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
                <circle r="3" fill="var(--slate)"/>
              </g>
              <!-- Left circle -->
              <g transform="translate(10,22.5)">
                <circle r="5.5" fill="var(--ivory)" stroke="var(--ivory)" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
                <circle r="3" fill="var(--slate)"/>
              </g>
            </svg>
            <div class="text-content">
              <div class="sigma-lab">EDGE LAB</div>
              <div class="sigmatiq-wrapper">
                <div class="sigmatiq">SIGMATIQ</div>
                <div class="tagline">EVIDENCE TO GOVERNED ACTION</div>
              </div>
            </div>
          </a>
        </div>
        <div class="top-bar-actions">
          <!-- Risk Profile Selector -->
          <div class="risk-profile-selector">
            <span class="sr-only">Risk Profile</span>
            <div class="risk-profile-chips" id="riskProfileChips">
              <button class="risk-chip" data-profile="conservative" title="Conservative Risk Profile">C</button>
              <button class="risk-chip active" data-profile="balanced" title="Balanced Risk Profile">B</button>
              <button class="risk-chip" data-profile="aggressive" title="Aggressive Risk Profile">A</button>
            </div>
          </div>
          <!-- Selection Cart Toggle -->
          <button id="cartToggle" class="cart-toggle" title="Selection Cart">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"/>
              <circle cx="20" cy="21" r="1"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <span class="cart-count" id="cartCount">0</span>
          </button>
          <!-- AI Assistant Toggle -->
          <button id="assistantToggle" class="assistant-toggle" title="AI Assistant">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
          </button>
          <button id="cmdk" class="theme-toggle" title="Command Palette (Ctrl/⌘+K)">⌘K</button>
          <button id="themeBtn" class="theme-toggle" title="Toggle Theme">◑</button>
          <label class="density-selector">
            <span class="sr-only">Density</span>
            <select id="densitySelect" class="density-select" title="UI Density">
              <option value="compact">Compact</option>
              <option value="cozy" selected>Cozy</option>
              <option value="comfortable">Comfortable</option>
            </select>
          </label>
        </div>
        </div>
      </header>
      <div class="main-layout">
        <aside class="sidebar" id="sidebar">
          <a class="nav-item" data-route="#/dashboard" href="#/dashboard"><svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="3" x2="12" y2="21"/><line x1="3" y1="12" x2="21" y2="12"/></svg><span>Dashboard</span></a>
          
          <div class="nav-item-expandable">
            <button class="nav-item nav-parent" data-toggle="packs">
              <svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
              <span>Packs</span>
              <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
            </button>
            <div class="nav-submenu" id="packs-submenu">
              <a class="nav-subitem" href="#/packs">Overview</a>
              <a class="nav-subitem" href="#/packs/templates">Templates Gallery</a>
            </div>
          </div>
          
          <div class="nav-item-expandable">
            <button class="nav-item nav-parent" data-toggle="models">
              <svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="2"/><circle cx="5" cy="5" r="2"/><circle cx="19" cy="5" r="2"/><circle cx="5" cy="19" r="2"/><circle cx="19" cy="19" r="2"/><path d="M7 6l3 3m4 0 3-3M7 18l3-3m4 0 3 3M10 10l4 4M10 14l4-4"/></svg>
              <span>Models</span>
              <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
            </button>
            <div class="nav-submenu" id="models-submenu">
              <a class="nav-subitem" href="#/models">List</a>
              <a class="nav-subitem" href="#/models/templates">Templates Gallery</a>
              <a class="nav-subitem" href="#/models/new">Create Model</a>
              <a class="nav-subitem" href="#/models/spy_opt_0dte_v2/designer">Designer</a>
              
              <div class="nav-item-expandable nav-nested">
                <button class="nav-subitem nav-parent" data-toggle="composer">
                  <span>Composer</span>
                  <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
                </button>
                <div class="nav-submenu nav-nested-submenu" id="composer-submenu">
                  <a class="nav-subitem nav-nested-item" href="#/models/spy_opt_0dte_v2/composer/build">Build</a>
                  <a class="nav-subitem nav-nested-item" href="#/models/spy_opt_0dte_v2/composer/sweeps">Sweeps</a>
                  <a class="nav-subitem nav-nested-item" href="#/models/spy_opt_0dte_v2/composer/leaderboard">Leaderboard</a>
                  <a class="nav-subitem nav-nested-item" href="#/models/spy_opt_0dte_v2/composer/backtest">Backtest</a>
                  <a class="nav-subitem nav-nested-item" href="#/models/spy_opt_0dte_v2/composer/train">Train</a>
                </div>
              </div>
            </div>
          </div>
          
          <div class="nav-item-expandable">
            <button class="nav-item nav-parent" data-toggle="signals">
              <svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg>
              <span>Signals</span>
              <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
            </button>
            <div class="nav-submenu" id="signals-submenu">
              <a class="nav-subitem" href="#/signals?tab=leaderboard">Leaderboard</a>
              <a class="nav-subitem" href="#/signals?tab=log">Log</a>
              <a class="nav-subitem" href="#/signals?tab=analytics">Analytics</a>
            </div>
          </div>
          <a class="nav-item" data-route="#/overlay" href="#/overlay"><svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="18" x2="12" y2="22"/></svg><span>Options Overlay</span></a>
          <a class="nav-item" data-route="#/health" href="#/health"><svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Health</span></a>
          <a class="nav-item" data-route="#/docs" href="#/docs"><svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg><span>Docs</span></a>
          
          <div class="nav-separator"></div>
          
          <div class="nav-item-expandable">
            <button class="nav-item nav-parent admin-only" data-toggle="admin">
              <svg aria-hidden="true" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
              <span>Admin</span>
              <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
            </button>
            <div class="nav-submenu" id="admin-submenu">
              <a class="nav-subitem" href="#/admin">Overview</a>
              <a class="nav-subitem" href="#/admin/jobs">Jobs</a>
              <a class="nav-subitem" href="#/admin/quotas">Quotas & Limits</a>
              <a class="nav-subitem" href="#/admin/risk-profiles">Risk Profiles</a>
              <a class="nav-subitem" href="#/admin/packs">Packs Manager</a>
              <a class="nav-subitem" href="#/admin/templates">Templates Manager</a>
              <a class="nav-subitem" href="#/admin/flags">Feature Flags</a>
              <a class="nav-subitem" href="#/admin/health">Data Health</a>
              <a class="nav-subitem" href="#/admin/audit">Audit & Logs</a>
              <a class="nav-subitem" href="#/admin/users">Users & Roles</a>
            </div>
          </div>
        </aside>
        <main class="content-area" id="app"></main>
      </div>
      <footer class="footer"><div class="footer-inner">API: dev | Env: local</div></footer>
    </div>
    <!-- Selection Cart Drawer -->
    <div id="selectionCart" class="drawer drawer-right" aria-hidden="true">
      <div class="drawer-header">
        <h2 class="drawer-title">Selection Cart</h2>
        <button class="drawer-close" id="cartClose" aria-label="Close selection cart">×</button>
      </div>
      <div class="drawer-content">
        <div class="cart-empty" id="cartEmpty">
          <p>No configurations selected yet.</p>
          <p>Add configs from Sweeps or Leaderboard to compare and train.</p>
        </div>
        <div class="cart-items" id="cartItems">
          <!-- Selected configurations will be rendered here -->
        </div>
        <div class="cart-actions" id="cartActions" style="display: none;">
          <button class="btn btn-secondary" id="cartCompare">Compare Selected</button>
          <button class="btn btn-primary" id="cartTrain">Train Selected</button>
        </div>
      </div>
    </div>
    
    <!-- AI Assistant Drawer -->
    <div id="aiAssistant" class="drawer drawer-right" aria-hidden="true">
      <div class="drawer-header">
        <h2 class="drawer-title">AI Assistant</h2>
        <button class="drawer-close" id="assistantClose" aria-label="Close AI assistant">×</button>
      </div>
      <div class="drawer-content">
        <div class="assistant-messages" id="assistantMessages">
          <div class="assistant-message system-message">
            <p>Hi! I'm your AI assistant. I can help you with:</p>
            <ul>
              <li>Building and running models</li>
              <li>Analyzing backtest results</li>
              <li>Explaining configurations and metrics</li>
              <li>Reading reports and data</li>
            </ul>
            <p>What would you like to know?</p>
          </div>
        </div>
        <div class="assistant-input">
          <input type="text" id="assistantInput" placeholder="Ask me anything..." aria-label="Ask AI assistant">
          <button id="assistantSend" aria-label="Send message">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22,2 15,22 11,13 2,9 22,2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Overlay shared by mobile sidebar, drawers and command palette -->
    <div id="overlay" class="overlay" aria-hidden="true"></div>
    <!-- Command palette dialog (accessible) -->
    <div id="cmdkDialog" class="cmdk" role="dialog" aria-modal="true" aria-labelledby="cmdkTitle" aria-hidden="true">
      <div class="cmdk-header">
        <strong id="cmdkTitle" style="color:var(--text-secondary);">Command Palette</strong>
        <input id="cmdkInput" class="cmdk-input" placeholder="Type a command…" aria-label="Command input" />
        <span class="kbd" aria-hidden="true">Esc</span>
      </div>
      <div class="cmdk-list" role="listbox" aria-label="Commands">
        <div class="cmdk-item" role="option" data-action="route:/dashboard">Open Dashboard <span class="kbd">D</span></div>
        <div class="cmdk-item" role="option" data-action="route:/packs">Open Packs <span class="kbd">P</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models">Open Models <span class="kbd">M</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models/new">Create Model <span class="kbd">C</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models/templates">Templates Gallery <span class="kbd">T</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models/spy_opt_0dte_v2/designer">Open Designer <span class="kbd">⌘E</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models/spy_opt_0dte_v2/composer/build">Open Composer <span class="kbd">⌘M</span></div>
        <div class="cmdk-item" role="option" data-action="route:/models/spy_opt_0dte_v2/composer/backtest">Open Backtest <span class="kbd">⌘B</span></div>
        <div class="cmdk-item" role="option" data-action="route:/signals?tab=leaderboard">Signals Leaderboard <span class="kbd">S</span></div>
        <div class="cmdk-item" role="option" data-action="route:/signals?tab=log">Signals Log <span class="kbd">⌘S</span></div>
        <div class="cmdk-item" role="option" data-action="route:/signals?tab=analytics">Signals Analytics <span class="kbd">⌘A</span></div>
        <div class="cmdk-item" role="option" data-action="route:/overlay">Options Overlay <span class="kbd">O</span></div>
        <div class="cmdk-item" role="option" data-action="route:/health">System Health <span class="kbd">H</span></div>
        <div class="cmdk-item" role="option" data-action="route:/docs">Open Docs <span class="kbd">⌘D</span></div>
        <div class="cmdk-item" role="option" data-action="route:/admin/jobs">Admin: Jobs <span class="kbd">⌘J</span></div>
        <div class="cmdk-item" role="option" data-action="drawer:cart">Selection Cart <span class="kbd">⌘C</span></div>
        <div class="cmdk-item" role="option" data-action="drawer:assistant">AI Assistant <span class="kbd">⌘I</span></div>
        <div class="cmdk-item" role="option" data-action="theme">Toggle Theme <span class="kbd">⌘T</span></div>
      </div>
    </div>

    <script>
      (function(){
        var s = document.createElement('script');
        if (location.protocol === 'file:') {
          s.src = 'bundle.js';
          s.defer = true;
        } else {
          s.type = 'module';
          s.src = 'app.js';
        }
        document.body.appendChild(s);
      })();
    </script>
  </body>
</html>
