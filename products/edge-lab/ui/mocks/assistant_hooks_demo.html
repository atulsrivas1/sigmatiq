<!doctype html>
<html lang="en" data-theme="light" data-density="cozy" data-edge="zeroedge">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Assistant Hooks Demo</title>
    <link rel="stylesheet" href="../assets/style.css" />
  </head>
  <body>
    <div class="content-area" style="max-width:1100px;margin:24px auto;">
      <h1 class="page-title">Assistant Hooks — Demo</h1>

      <section class="card" style="margin-bottom:24px;">
        <h2 class="section-title">Designer — Policy Errors</h2>
        <pre class="console-output" style="background:var(--surface-2); padding:12px; border:1px solid var(--border-color); border-radius:8px;">
errors:
- execution.slippage_bps must be a number
- alerting.cooldown_minutes must be a number
        </pre>
        <button class="btn btn-primary" data-ai-hook data-ai-context="policy" id="aiFixPolicy">Ask AI to fix</button>
      </section>

      <section class="card" style="margin-bottom:24px;">
        <h2 class="section-title">Composer — Sweeps Recommendation</h2>
        <div class="form-row">
          <label class="form-label">Thresholds Variants</label>
          <input class="input" placeholder="e.g., 0.55,0.60,0.65" />
        </div>
        <button class="btn btn-secondary" data-ai-hook data-ai-context="sweeps" id="aiRecommendSweeps">Ask AI to recommend sweeps</button>
      </section>

      <section class="card">
        <h2 class="section-title">Signals — Anomaly Insight</h2>
        <div class="meta-text">Fill rate dropped on 2025-08-16</div>
        <button class="btn btn-secondary" data-ai-hook data-ai-context="signals" id="aiSignalsWhy">Why did fill rate dip?</button>
      </section>

      <div id="aiOut" class="sample-card" style="margin-top:24px;">Click any Ask AI button above. Payloads will be logged here.</div>
    </div>

    <script>
      function buildContext(el){
        return {
          route: location.hash || '#/demo',
          model_id: 'spy_opt_0dte_hourly',
          pack_id: 'zeroedge',
          risk_profile: 'balanced',
          view: el.dataset.aiContext || 'demo',
          form_values: {},
          selection: [],
          recent_api: {},
          user_prompt: el.innerText
        };
      }
      async function handleAIHook(ev){
        const el = ev.target.closest('[data-ai-hook]');
        if(!el) return;
        const packet = buildContext(el);
        const out = document.getElementById('aiOut');
        out.textContent = 'Posting to /assistant/query with context: ' + JSON.stringify(packet, null, 2);
        // Example POST (disabled in mock):
        // const res = await fetch('/assistant/query', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(packet)});
        // const data = await res.json();
        // out.textContent = 'Assistant response: ' + JSON.stringify(data, null, 2);
      }
      document.addEventListener('click', handleAIHook);
    </script>
  </body>
</html>
