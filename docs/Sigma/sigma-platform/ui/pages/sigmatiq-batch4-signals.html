<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIGMATIQ - P1: Signals Components (Card/Row Leaderboard)</title>
  <style>
    :root {
      --sigmatiq-dark-teal: #1A2F2F;
      --sigmatiq-bright-teal: #00C4A7;
      --sigmatiq-golden: #FFB800;
      --color-bg: #0A1414;
      --color-surface-1: #0F1A1A;
      --color-surface-2: #111827;
      --color-surface-3: #1A2F2F;
      --color-border: #1A2F2F;
      --color-text-1: #F5F5F7;
      --color-text-2: #8FA5A5;
      --color-text-3: #6A8080;
      --status-success: #00C4A7;
      --status-warning: #FFB800;
      --status-error: #FF5757;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system,BlinkMacSystemFont,Inter,sans-serif; background: var(--color-bg); color: var(--color-text-1); padding: 24px; }
    .section { margin-bottom: 48px; max-width: 1400px; margin-left: auto; margin-right: auto; }
    .section-title { color: var(--sigmatiq-bright-teal); font-size: 24px; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid var(--color-border); }

    /* ============ Tabs ============ */
    .signals-container { background: var(--color-surface-1); border: 1px solid var(--color-border); border-radius: 12px; overflow: hidden; }
    .signals-tabs { display: flex; border-bottom: 1px solid var(--color-border); background: var(--color-surface-2); }
    .signals-tab { padding: 16px 24px; background: none; border: none; color: var(--color-text-2); font-weight: 500; cursor: pointer; position: relative; transition: .2s; }
    .signals-tab:hover { color: var(--color-text-1); }
    .signals-tab.active { color: var(--sigmatiq-bright-teal); background: var(--color-surface-1); }
    .signals-tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--sigmatiq-bright-teal); }
    .signals-content { padding: 24px; }

    /* ============ Leaderboard controls ============ */
    .lb-controls { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 12px; }
    .lb-search { flex: 1; min-width: 220px; }
    .lb-search input { width: 100%; padding: 8px 12px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; color: var(--color-text-1); font-size: 13px; outline: none; }
    .lb-search input:focus { border-color: var(--sigmatiq-bright-teal); box-shadow: 0 0 0 2px rgba(0,196,167,.12); }
    .lb-select { padding: 8px 12px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; color: var(--color-text-1); font-size: 13px; cursor: pointer; }
    .lb-checkbox { display: flex; align-items: center; gap: 8px; color: var(--color-text-2); font-size: 13px; margin-left: auto; }
    .view-toggle { display: flex; gap: 2px; padding: 3px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; }
    .view-option { padding: 5px 8px; background: transparent; border: none; color: var(--color-text-2); cursor: pointer; border-radius: 5px; font-size: 12px; }
    .view-option.active { background: var(--sigmatiq-bright-teal); color: var(--color-bg); }

    /* ============ Leaderboard grid/cards ============ */
    .lb-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 12px; align-items: stretch; margin-top: 8px; }
    .lb-grid.row-view { display: block; }

    .lb-card { background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 10px; overflow: hidden; transition: .2s; }
    .lb-card:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,.2); border-color: var(--sigmatiq-bright-teal); }

    .lb-head { display: flex; align-items: center; gap: 10px; background: var(--color-surface-3); padding: 12px; border-bottom: 1px solid var(--color-border); }
    .lb-title { font-size: 13px; font-weight: 700; color: var(--color-text-1); font-family: Monaco,Menlo,Consolas,monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .lb-sub { font-size: 11px; color: var(--color-text-3); }
    .risk-badge { margin-left: auto; padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: 700; }
    .risk-badge.B { background: rgba(255,184,0,.2); color: var(--sigmatiq-golden); } /* Balanced */
    .risk-badge.C { background: rgba(76,175,80,.2); color: #4CAF50; }             /* Conservative */
    .risk-badge.A { background: rgba(255,87,87,.2); color: var(--status-error); } /* Aggressive */

    .lb-body { padding: 12px; }
    .lb-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
    .stat { display: flex; flex-direction: column; }
    .stat .label { font-size: 10px; color: var(--color-text-3); text-transform: uppercase; letter-spacing: .3px; margin-bottom: 2px; }
    .stat .val { font-size: 14px; font-weight: 600; color: var(--color-text-1); }
    .val.positive { color: var(--status-success); }
    .val.negative { color: var(--status-error); }

    .capacity { width: 100%; }
    .capacity-bar { width: 100%; height: 8px; background: var(--color-surface-3); border-radius: 4px; overflow: hidden; }
    .capacity-fill { height: 100%; background: linear-gradient(90deg, var(--status-success), var(--sigmatiq-bright-teal)); border-radius: 4px; transition: width .3s; }
    .capacity-label { display: flex; justify-content: space-between; margin-top: 4px; font-size: 11px; color: var(--color-text-3); }

    .lb-meta { display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid var(--color-border); font-size: 10px; color: var(--color-text-3); }

    /* Row reflow */
    .lb-grid.row-view .lb-card { display: flex; align-items: center; margin-bottom: 8px; padding: 12px; border-radius: 8px; }
    .lb-grid.row-view .lb-head { background: transparent; border: 0; padding: 0; gap: 12px; flex: 0 0 340px; }
    .lb-grid.row-view .lb-body { flex: 1; padding: 0 16px; }
    .lb-grid.row-view .lb-stats { display: flex; gap: 20px; margin: 0; }
    .lb-grid.row-view .stat { flex-direction: row; align-items: baseline; gap: 6px; }
    .lb-grid.row-view .capacity,
    .lb-grid.row-view .lb-meta { display: none; }

    /* Row header */
    .lb-row-header { display: none; padding: 8px 12px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; margin-bottom: 8px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: .5px; color: var(--color-text-3); }
    .lb-grid.row-view ~ .lb-row-header { display: flex; align-items: center; }
    .hdr-model { flex: 0 0 340px; padding-left: 4px; }
    .hdr-metrics { flex: 1; display: flex; gap: 20px; }

    /* Pagination */
    .lb-pagination { display: flex; justify-content: space-between; align-items: center; padding: 12px 0 0; }
    .page-btn { padding: 6px 10px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 6px; color: var(--color-text-1); font-size: 12px; cursor: pointer; min-width: 32px; }
    .page-btn[disabled] { opacity: .5; cursor: not-allowed; }
    .page-btn.active { background: var(--sigmatiq-bright-teal); border-color: var(--sigmatiq-bright-teal); color: var(--color-bg); }

    /* ============ Log and Analytics from original ============ */
    .signals-filters { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-input, .filter-select, .date-input { padding: 10px 14px; background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; color: var(--color-text-1); outline: none; }
    .signals-log-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .signals-log-table th { text-align: left; padding: 10px; border-bottom: 1px solid var(--color-border); color: var(--color-text-2); font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .signals-log-table td { padding: 10px; border-bottom: 1px solid var(--color-border); }
    .signal-side { padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .signal-side.long { background: rgba(0,196,167,.2); color: var(--status-success); }
    .signal-side.short { background: rgba(255,87,87,.2); color: var(--status-error); }
    .signal-status { padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .signal-status.filled { background: rgba(0,196,167,.2); color: var(--status-success); }
    .signal-status.pending { background: rgba(255,184,0,.2); color: var(--status-warning); }
    .signal-status.cancelled { background: rgba(134,142,150,.2); color: var(--color-text-3); }

    .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .analytics-card { background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; padding: 16px; }
    .analytics-label { font-size: 11px; color: var(--color-text-3); text-transform: uppercase; letter-spacing: .5px; margin-bottom: 8px; }
    .analytics-value { font-size: 24px; font-weight: 600; }
    .analytics-change { font-size: 12px; margin-top: 4px; }
    .chart-container { background: var(--color-surface-2); border: 1px solid var(--color-border); border-radius: 8px; padding: 20px; margin-bottom: 20px; }
    .chart-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; }
    .chart-placeholder { height: 300px; display: flex; align-items: center; justify-content: center; color: var(--color-text-3); border: 2px dashed var(--color-border); border-radius: 8px; }

    .heatmap-grid { display: grid; grid-template-columns: auto repeat(7,1fr); gap: 4px; font-size: 11px; }
    .heatmap-hour-label { display: flex; align-items: center; justify-content: right; padding-right: 8px; color: var(--color-text-3); }
    .heatmap-day-label { display: flex; align-items: center; justify-content: center; padding-bottom: 4px; color: var(--color-text-3); }
    .heatmap-cell { aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; cursor: pointer; transition: .2s; }
    .heatmap-cell:hover { transform: scale(1.1); box-shadow: 0 2px 8px rgba(0,0,0,.3); }
    .heatmap-cell.low { background: rgba(0,196,167,.2); color: var(--status-success); }
    .heatmap-cell.medium { background: rgba(0,196,167,.5); color: var(--status-success); }
    .heatmap-cell.high { background: rgba(0,196,167,.8); color: #fff; }
    .heatmap-cell.negative { background: rgba(255,87,87,.5); color: #fff; }
  </style>
</head>
<body>
  <!-- SIGNALS SECTION -->
  <section class="section">
    <h2 class="section-title">Signals (P1)</h2>

    <div class="signals-container">
      <!-- Tabs -->
      <div class="signals-tabs">
        <button class="signals-tab active" onclick="switchSignalTab(this, 'leaderboard')">Leaderboard</button>
        <button class="signals-tab" onclick="switchSignalTab(this, 'log')">Log</button>
        <button class="signals-tab" onclick="switchSignalTab(this, 'analytics')">Analytics</button>
      </div>

      <!-- LEADERBOARD TAB -->
      <div class="signals-content" id="leaderboard-tab">
        <!-- Controls -->
        <div class="lb-controls">
          <div class="lb-search">
            <input id="lbSearch" type="text" placeholder="Search models…"/>
          </div>

          <select id="lbPack" class="lb-select" aria-label="Pack">
            <option value="">All Packs</option>
            <option value="zerosigma">zerosigma</option>
            <option value="swingsigma">swingsigma</option>
          </select>

          <select id="lbRisk" class="lb-select" aria-label="Risk">
            <option value="">All Risk Profiles</option>
            <option value="Conservative">Conservative</option>
            <option value="Balanced">Balanced</option>
            <option value="Aggressive">Aggressive</option>
          </select>

          <select id="lbPeriod" class="lb-select" aria-label="Period">
            <option value="30">Last 30 Days</option>
            <option value="7">Last 7 Days</option>
            <option value="1">Today</option>
          </select>

          <label class="lb-checkbox">
            <input id="lbPassOnly" type="checkbox"/> Pass Gate Only
          </label>

          <select id="lbSort" class="lb-select" aria-label="Sort">
            <option value="updated_desc">Sort: Updated</option>
            <option value="sharpe_desc">Sort: Sharpe</option>
            <option value="return_desc">Sort: Return</option>
            <option value="win_desc">Sort: Win Rate</option>
            <option value="trades_desc">Sort: Trades</option>
            <option value="fill_desc">Sort: Fill Rate</option>
            <option value="slip_asc">Sort: Avg Slip</option>
          </select>

          <select id="lbPageSize" class="lb-select" aria-label="Items">
            <option>6</option><option selected>12</option><option>24</option>
          </select>

          <div class="view-toggle" role="tablist" aria-label="View">
            <button id="lbViewCards" class="view-option active" aria-selected="true">Cards</button>
            <button id="lbViewRows" class="view-option" aria-selected="false">Rows</button>
          </div>
        </div>

        <!-- Grid -->
        <div class="lb-grid" id="lbGrid">
          <!-- Card 1 -->
          <article class="lb-card"
                   data-id="spy_opt_0dte_hourly"
                   data-pack="zerosigma"
                   data-risk="Balanced"
                   data-risk-letter="B"
                   data-period="30"
                   data-pass="true"
                   data-sharpe="1.18"
                   data-return="6.2"
                   data-win="58"
                   data-trades="142"
                   data-fill="87"
                   data-slip="0.03"
                   data-updated-min="2880">
            <div class="lb-head">
              <div>
                <div class="lb-title">spy_opt_0dte_hourly</div>
                <div class="lb-sub">ZeroSigma • Jul 18 → Aug 16</div>
              </div>
              <span class="risk-badge B" title="Balanced">B</span>
            </div>
            <div class="lb-body">
              <div class="lb-stats">
                <div class="stat"><span class="label">Sharpe</span><span class="val">1.18</span></div>
                <div class="stat"><span class="label">Return</span><span class="val positive">+6.2%</span></div>
                <div class="stat"><span class="label">Win Rate</span><span class="val">58%</span></div>
                <div class="stat"><span class="label">Trades</span><span class="val">142</span></div>
                <div class="stat"><span class="label">Fill Rate</span><span class="val">87%</span></div>
                <div class="stat"><span class="label">Avg Slip</span><span class="val">$0.03</span></div>
              </div>
              <div class="capacity">
                <div class="capacity-bar"><div class="capacity-fill" style="width:75%"></div></div>
                <div class="capacity-label"><span>Capacity</span><span>High</span></div>
              </div>
              <div class="lb-meta"><span>Updated 2 days ago</span><span>Pass Gate: Yes</span></div>
            </div>
          </article>

          <!-- Card 2 -->
          <article class="lb-card"
                   data-id="aapl_eq_swing_daily"
                   data-pack="swingsigma"
                   data-risk="Conservative"
                   data-risk-letter="C"
                   data-period="30"
                   data-pass="true"
                   data-sharpe="0.95"
                   data-return="4.8"
                   data-win="52"
                   data-trades="87"
                   data-fill="92"
                   data-slip="0.02"
                   data-updated-min="7200">
            <div class="lb-head">
              <div>
                <div class="lb-title">aapl_eq_swing_daily</div>
                <div class="lb-sub">SwingSigma • Jul 18 → Aug 16</div>
              </div>
              <span class="risk-badge C" title="Conservative">C</span>
            </div>
            <div class="lb-body">
              <div class="lb-stats">
                <div class="stat"><span class="label">Sharpe</span><span class="val">0.95</span></div>
                <div class="stat"><span class="label">Return</span><span class="val positive">+4.8%</span></div>
                <div class="stat"><span class="label">Win Rate</span><span class="val">52%</span></div>
                <div class="stat"><span class="label">Trades</span><span class="val">87</span></div>
                <div class="stat"><span class="label">Fill Rate</span><span class="val">92%</span></div>
                <div class="stat"><span class="label">Avg Slip</span><span class="val">$0.02</span></div>
              </div>
              <div class="capacity">
                <div class="capacity-bar"><div class="capacity-fill" style="width:45%"></div></div>
                <div class="capacity-label"><span>Capacity</span><span>Med</span></div>
              </div>
              <div class="lb-meta"><span>Updated 5 hours ago</span><span>Pass Gate: Yes</span></div>
            </div>
          </article>
        </div>

        <!-- Row header (shown only in row view) -->
        <div class="lb-row-header" id="lbRowHeader">
          <div class="hdr-model">Model</div>
          <div class="hdr-metrics">
            <div>Sharpe</div><div>Return</div><div>Win</div><div>Trades</div><div>Fill</div><div>Slip</div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="lb-pagination">
          <div id="lbPageInfo" style="font-size:13px;color:var(--color-text-2)">–</div>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="page-btn" id="lbPrev">‹</button>
            <span id="lbNums" style="display:flex;gap:6px"></span>
            <button class="page-btn" id="lbNext">›</button>
          </div>
        </div>
      </div>

      <!-- LOG TAB (unchanged) -->
      <div class="signals-content" id="log-tab" style="display:none">
        <div class="signals-filters">
          <input type="date" class="date-input" value="2025-08-19"/>
          <input type="text" class="filter-input" placeholder="Ticker..." style="width:120px"/>
          <select class="filter-select">
            <option>All Status</option><option>Filled</option><option>Pending</option><option>Cancelled</option>
          </select>
          <button class="export-btn" style="margin-left:auto;display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background:var(--color-surface-2);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-1);font-size:14px;cursor:pointer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            Export CSV
          </button>
        </div>

        <table class="signals-log-table">
          <thead><tr><th>Timestamp</th><th>Model ID</th><th>Side</th><th>Entry Ref</th><th>Fill Price</th><th>Slippage</th><th>Status</th><th>R:R</th><th>PnL</th><th>Tag</th></tr></thead>
          <tbody>
            <tr>
              <td style="font-size:12px;color:var(--color-text-2)">2025-08-19 09:30:15</td>
              <td>spy_opt_0dte_hourly</td>
              <td><span class="signal-side long">LONG</span></td>
              <td>447.35</td><td>447.37</td><td style="color:var(--status-warning)">0.02</td>
              <td><span class="signal-status filled">FILLED</span></td><td>1.8</td><td class="metric-value positive">+$125</td>
              <td style="font-size:11px;color:var(--color-text-3)">live</td>
            </tr>
            <tr>
              <td style="font-size:12px;color:var(--color-text-2)">2025-08-19 10:15:22</td>
              <td>aapl_eq_swing_daily</td>
              <td><span class="signal-side short">SHORT</span></td>
              <td>178.92</td><td>178.90</td><td style="color:var(--status-success)">-0.02</td>
              <td><span class="signal-status filled">FILLED</span></td><td>2.1</td><td class="metric-value positive">+$87</td>
              <td style="font-size:11px;color:var(--color-text-3)">live</td>
            </tr>
            <tr>
              <td style="font-size:12px;color:var(--color-text-2)">2025-08-19 11:45:08</td>
              <td>tsla_opt_weekly</td>
              <td><span class="signal-side long">LONG</span></td>
              <td>215.30</td><td>—</td><td>—</td>
              <td><span class="signal-status pending">PENDING</span></td><td>1.5</td><td>—</td>
              <td style="font-size:11px;color:var(--color-text-3)">test</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ANALYTICS TAB (unchanged) -->
      <div class="signals-content" id="analytics-tab" style="display:none">
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-label">Total PnL</div>
            <div class="analytics-value" style="color:var(--status-success)">+$12,450</div>
            <div class="analytics-change" style="color:var(--status-success)">↑ 12.5% vs last period</div>
          </div>
          <div class="analytics-card"><div class="analytics-label">Win Rate</div><div class="analytics-value">62%</div><div class="analytics-change" style="color:var(--status-success)">↑ 3% vs last period</div></div>
          <div class="analytics-card"><div class="analytics-label">Sharpe Ratio</div><div class="analytics-value">1.85</div><div class="analytics-change" style="color:var(--status-warning)">↓ 0.15 vs last period</div></div>
          <div class="analytics-card"><div class="analytics-label">Total Trades</div><div class="analytics-value">342</div><div class="analytics-change" style="color:var(--color-text-3)">→ Same as last period</div></div>
          <div class="analytics-card"><div class="analytics-label">Avg Fill Rate</div><div class="analytics-value">89%</div><div class="analytics-change" style="color:var(--status-success)">↑ 2% vs last period</div></div>
          <div class="analytics-card"><div class="analytics-label">Max Drawdown</div><div class="analytics-value" style="color:var(--status-error)">-8.2%</div><div class="analytics-change" style="color:var(--status-success)">Better than -12%</div></div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Equity Curve & Drawdown</div>
          <div class="chart-placeholder">
            <svg width="100%" height="300" viewBox="0 0 800 300">
              <defs>
                <linearGradient id="equityGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:var(--sigmatiq-bright-teal);stop-opacity:0.3"/>
                  <stop offset="100%" style="stop-color:var(--sigmatiq-bright-teal);stop-opacity:0"/>
                </linearGradient>
              </defs>
              <path d="M 50 200 Q 150 180 250 160 T 450 120 Q 550 100 650 80 T 750 60"
                    stroke="var(--sigmatiq-bright-teal)" stroke-width="2" fill="none"/>
              <path d="M 50 200 Q 150 180 250 160 T 450 120 Q 550 100 650 80 T 750 60 L 750 250 L 50 250 Z"
                    fill="url(#equityGradient)"/>
              <path d="M 50 250 Q 150 245 250 248 T 450 240 Q 550 235 650 238 T 750 230"
                    stroke="var(--status-error)" stroke-width="1" fill="none" stroke-dasharray="5,5"/>
            </svg>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Performance by Hour & Day</div>
          <div class="heatmap-grid">
            <div></div>
            <div class="heatmap-day-label">Mon</div><div class="heatmap-day-label">Tue</div><div class="heatmap-day-label">Wed</div><div class="heatmap-day-label">Thu</div><div class="heatmap-day-label">Fri</div><div class="heatmap-day-label">Sat</div><div class="heatmap-day-label">Sun</div>

            <div class="heatmap-hour-label">9:30</div>
            <div class="heatmap-cell high">+2.1%</div><div class="heatmap-cell medium">+1.2%</div><div class="heatmap-cell low">+0.5%</div><div class="heatmap-cell high">+1.8%</div><div class="heatmap-cell negative">-0.3%</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div>

            <div class="heatmap-hour-label">10:00</div>
            <div class="heatmap-cell medium">+0.8%</div><div class="heatmap-cell low">+0.3%</div><div class="heatmap-cell negative">-0.5%</div><div class="heatmap-cell medium">+1.1%</div><div class="heatmap-cell high">+2.3%</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div>

            <div class="heatmap-hour-label">14:00</div>
            <div class="heatmap-cell low">+0.2%</div><div class="heatmap-cell medium">+0.9%</div><div class="heatmap-cell high">+1.7%</div><div class="heatmap-cell low">+0.4%</div><div class="heatmap-cell medium">+1.0%</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div>

            <div class="heatmap-hour-label">15:00</div>
            <div class="heatmap-cell negative">-0.8%</div><div class="heatmap-cell low">+0.1%</div><div class="heatmap-cell medium">+0.7%</div><div class="heatmap-cell negative">-0.2%</div><div class="heatmap-cell high">+1.5%</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div><div class="heatmap-cell" style="background:var(--color-surface-3)">—</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    function switchSignalTab(element, tabName) {
      document.querySelectorAll('.signals-tab').forEach(t => t.classList.remove('active'));
      element.classList.add('active');
      document.querySelectorAll('.signals-content').forEach(c => c.style.display = 'none');
      document.getElementById(tabName + '-tab').style.display = 'block';
    }

    // Leaderboard: search • filters • sort • paging • view toggle
    (function(){
      const grid = document.getElementById('lbGrid');
      const cards = Array.from(grid.querySelectorAll('.lb-card'));

      const q = document.getElementById('lbSearch');
      const packSel = document.getElementById('lbPack');
      const riskSel = document.getElementById('lbRisk');
      const periodSel = document.getElementById('lbPeriod');
      const passOnly = document.getElementById('lbPassOnly');
      const sortSel = document.getElementById('lbSort');
      const sizeSel = document.getElementById('lbPageSize');
      const prev = document.getElementById('lbPrev');
      const next = document.getElementById('lbNext');
      const nums = document.getElementById('lbNums');
      const info = document.getElementById('lbPageInfo');
      const viewCards = document.getElementById('lbViewCards');
      const viewRows  = document.getElementById('lbViewRows');
      const rowHeader = document.getElementById('lbRowHeader');

      function row(c){
        const d = c.dataset;
        return {
          el: c,
          id: d.id || '',
          pack: d.pack || '',
          risk: d.risk || '',
          riskLetter: d.riskLetter || '',
          period: d.period || '30',
          pass: d.pass === 'true',
          sharpe: parseFloat(d.sharpe || '0') || 0,
          ret: parseFloat(d.return || '0') || 0,
          win: parseFloat(d.win || '0') || 0,
          trades: parseInt(d.trades || '0', 10) || 0,
          fill: parseFloat(d.fill || '0') || 0,
          slip: parseFloat(d.slip || '0') || 0,
          updatedMin: parseInt(d.updatedMin || '99999999', 10) || 99999999
        };
      }
      const rows = cards.map(row);

      let state = {
        term: '', pack: '', risk: '', period: periodSel.value, passOnly: false,
        sort: 'updated_desc', page: 1, size: parseInt(sizeSel.value, 10)
      };

      function apply(){
        // filter
        const t = state.term.toLowerCase();
        let filtered = rows.filter(r =>
          (!t || r.id.toLowerCase().includes(t)) &&
          (!state.pack || r.pack === state.pack) &&
          (!state.risk || r.risk === state.risk) &&
          (!state.period || r.period === state.period) &&
          (!state.passOnly || r.pass)
        );

        // sort
        const sorters = {
          updated_desc: (a,b) => a.updatedMin - b.updatedMin,
          sharpe_desc:  (a,b) => b.sharpe - a.sharpe || a.id.localeCompare(b.id),
          return_desc:  (a,b) => b.ret - a.ret || a.id.localeCompare(b.id),
          win_desc:     (a,b) => b.win - a.win || a.id.localeCompare(b.id),
          trades_desc:  (a,b) => b.trades - a.trades || a.id.localeCompare(b.id),
          fill_desc:    (a,b) => b.fill - a.fill || a.id.localeCompare(b.id),
          slip_asc:     (a,b) => a.slip - b.slip || a.id.localeCompare(b.id),
        };
        filtered.sort(sorters[state.sort] || sorters.updated_desc);

        // pagination
        const total = filtered.length;
        const pages = Math.max(1, Math.ceil(total / state.size));
        state.page = Math.min(state.page, pages);
        const start = (state.page - 1) * state.size;
        const slice = filtered.slice(start, start + state.size);

        // reorder DOM
        const frag = document.createDocumentFragment();
        slice.forEach(r => frag.appendChild(r.el));
        grid.innerHTML = '';
        grid.appendChild(frag);

        // page UI
        info.textContent = total ? `Showing ${start + 1}–${Math.min(start + state.size, total)} of ${total} models` : 'No results';
        nums.innerHTML = '';
        for (let i = 1; i <= pages; i++){
          const b = document.createElement('button');
          b.className = 'page-btn' + (i === state.page ? ' active' : '');
          b.textContent = i;
          b.addEventListener('click', () => { state.page = i; apply(); });
          nums.appendChild(b);
        }
        prev.disabled = state.page === 1;
        next.disabled = state.page === pages;
      }

      // events
      q.addEventListener('input', e => { state.term = e.target.value; state.page = 1; apply(); });
      packSel.addEventListener('change', e => { state.pack = e.target.value; state.page = 1; apply(); });
      riskSel.addEventListener('change', e => { state.risk = e.target.value; state.page = 1; apply(); });
      periodSel.addEventListener('change', e => { state.period = e.target.value; state.page = 1; apply(); });
      passOnly.addEventListener('change', e => { state.passOnly = e.target.checked; state.page = 1; apply(); });
      sortSel.addEventListener('change', e => { state.sort = e.target.value; state.page = 1; apply(); });
      sizeSel.addEventListener('change', e => { state.size = parseInt(e.target.value,10); state.page = 1; apply(); });
      prev.addEventListener('click', () => { if (state.page > 1) { state.page--; apply(); }});
      next.addEventListener('click', () => { state.page++; apply(); });

      viewCards.addEventListener('click', () => {
        viewCards.classList.add('active'); viewRows.classList.remove('active');
        grid.classList.remove('row-view'); rowHeader.style.display = 'none';
      });
      viewRows.addEventListener('click', () => {
        viewRows.classList.add('active'); viewCards.classList.remove('active');
        grid.classList.add('row-view'); rowHeader.style.display = 'flex';
      });

      apply();
    })();
  </script>
</body>
</html>
